workflows:
  ios-automatic-code-signing:
    name: Lion Master Chef
    instance_type: mac_pro
    working_directory: /Users/akramkhunaizi/Documents/GitHub/Lion-Master-Chef
    environment:
      groups:
        - ios_creds # <-- (group contains variables: APP_STORE_CONNECT_ISSUER_ID, APP_STORE_CONNECT_KEY_IDENTIFIER, APP_STORE_CONNECT_PRIVATE_KEY, CERTIFICATE_PRIVATE_KEY)
      vars:
        XCODE_WORKSPACE: "Unity-iPhone.xcworkspace"
        XCODE_SCHEME: "Unity-iPhone"
        BUNDLE_ID: "com.lion.ht"
        APP_STORE_APP_ID: 6448666144
      xcode: 14.2
         cocoapods: default
         ios_signing:
           distribution_type: app_store
           bundle_identifier: com.lion.ht
      triggering:
         events:
           - push
Expand All	@@ -31,33 +24,29 @@ workflows:
             source: true
       scripts:
         - name: Codemagic CLI Tools build
         script: pip3 install codemagic-cli-tools # The Codemagic CLI tools are already installed on Codemagic servers
         - name: Initialize Pods 
           script: pod init && pod install
         - name: Set up provisioning profiles settings on Xcode project
           script: xcode-project use-profiles
         - name: Increment build number
           script: agvtool new-version -all $(($(app-store-connect get-latest-build-number "$APP_STORE_APP_ID") + 1))
         - name: Create archive
           script: xcode-project build-ipa --workspace "$XCODE_WORKSPACE" --scheme "$XCODE_SCHEME" --archive-xcargs "CODE_SIGN_STYLE=Manual DEVELOPMENT_TEAM=" --archive-flags "-destination 'generic/platform=iOS' CODE_SIGNING_REQUIRED=YES CODE_SIGNING_ALLOWED=NO"
         - name: Publish on App Store
           script: app-store-connect publish --beta-build-localizations=@file:whats_new.json
            artifacts:
         - build/ios/ipa/*.ipa
         - $HOME/Library/Developer/Xcode/DerivedData/**/Build/**/*.dSYM
         - $HOME/Library/Developer/Xcode/DerivedData/**/Build/**/*.app
      
          app_store_connect:
              # Use referenced App Store Connect API key to authenticate binary upload
            auth: integration
            submit_to_testflight: true                     # Optional boolean, defaults to false. Whether or not to submit the uploaded build to TestFlight beta review. Required for distributing to beta groups. Note: This action is performed during post-processing.
            # beta_groups:                                  # Specify the names of beta tester groups that will get access to the build once it has passed beta review. 
            #      - group name 1
            #      - group name 2                      
          email:
            recipients:
            -akram84@me.com